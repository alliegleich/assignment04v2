---
title: "Introduction to Data Science"
subtitle: "Problem Set 4"
editor: visual
author: "Alicia Helfrich and Allie Gleich"
format: 
  pdf:
    code-line-numbers: false
  html: 
    code-line-numbers: false
    self-contained: true
urlcolor: blue
geometry: margin=1.5in
---

```{r}
#\| label: rmarkdown-setup #\| echo: false #\| include: false

library(tidyverse)
library(knitr)
library(ggplot2)
library(janitor)
library(haven)

```

# Problem Set 4: General Social Survey Analysis

## Set Up

```{r}

base_url <- "https://gss.norc.org/Documents/sas/"
week_url <- "GSS_sas.zip"
pulse_url <- paste0(base_url, week_url)

dir.create("data")

download.file(
pulse_url,
destfile = "data/GSS_sas.zip",
mode = "wb"
)

zip_file <- "data/GSS_sas.zip"

unzip(zip_file, exdir= "data")

gss <- (read_sas("data/GSS_sas/gss7222_r1.sas7bdat")) %>% 

  select(YEAR,ID,WRKSTAT,MARITAL,AGE,EDUC,SEX,RACE,BORN,GRANBORN,INCOME,PARTYID,NATAID,RELIG,HAPPY,CONEDUC,MYSKILLS,HISPANIC,BALLOT,ETHWORLD1,ETHWORLD2,ETHWORLD3,ETHWORLD4,ETHWORLD5,ETHWORLD6,ETHWORLD7,ETHWORLD8,ETHWORLD9) %>% 
    filter(YEAR == 2022) 

clean_names(gss)
```

The following dataset is pulled from the annual NORC General Social Survey for the year 2022. The survey collects a range of data based on social characteristics and attitudes from a representative sample of the US population. We were interested in looking at exploring how particular variables, such as years of education, income, age, religion may interact with reported happiness levels of respondents.

## Data Visualization #1: Exploring Happiness Levels in 2022

```{r}
ggplot(data = gss, aes(x = HAPPY)) + geom_histogram(position = "dodge", width = 10.5, na.rm = TRUE) +  scale_x_continuous(breaks = c(1, 2, 3)) + scale_y_continuous(limits = c(0, NA)) + theme_classic() +
  labs(
    title = "2021 Levels of Happiness",
    x = "Happiness Level",
    y = "Frequency",
    caption = "Data from the General Social Survey")


```

The above graph shows that the majority of the respondents ranked their happiness at a 2 out of 3, three being the most happy. The least amount of people ranked themselves at 1, coded to represent "Not Too Happy", which shows people are generally happy. To continue making public policy decisions that are targeted at improving people's overall happiness, we should further explore the respondents that ranked themselves as a 1 and see if there are other correlated variables that may be leading to this.

## Data Visualization #2: Investigating a potential relationship between labor force status and happiness levels

```{r}


#Creating a sub dataframe with text values for labor force status and happiness levels. 
labfor <- 
  gss %>% 
    select(WRKSTAT,HAPPY) %>% 
  mutate(
    lab_stat = case_when(
      WRKSTAT == 1 ~ "Full Time",
      WRKSTAT == 2 ~ "Part Time",
      WRKSTAT == 3 ~ "Other",
      WRKSTAT == 4 ~ "Unemployed",
      WRKSTAT > 4 ~ "Out of Labor Force",
      WRKSTAT < 1 ~ "N/A",
    ),
    happy_text = case_when(
      HAPPY == 1 ~ "Very Happy",
      HAPPY == 2 ~ "Pretty Happy",
      HAPPY == 3 ~ "Not too Happy",
      HAPPY < 1 ~ "N/A"
    )
  ) %>% 
  filter(lab_stat == "Full Time" | lab_stat == "Part Time" | lab_stat == "Unemployed", 
         HAPPY != "N/A"
         ) 

#creating a stacked bar graph to depict the proportion of individuals that reported each happiness level, by general employment status.

color_palette <- c("#E41A1C", "#377EB8", "#4DAF4A")

ggplot(data = labfor,aes(x = lab_stat, fill = happy_text)) +
   geom_bar(position = "fill") +
  labs(title = "Happiness Levels Based on Employment Status",
       x = "Employment Status",
       y = "Percent of Total Responses") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  scale_fill_discrete(name = "Happiness Level")


```

## Data Visualization #3: Exploring how religious identity relates to reported happiness levels

```{r}

gss_marital_happy <- gss %>%
  group_by(HAPPY, MARITAL) %>%
  tally()

gss_marital_happy %>% filter(!is.na(n)) %>%
  
ggplot(aes(x = MARITAL, y = HAPPY)) + geom_point(aes(size = n)) + scale_x_continuous(breaks = (seq(1, 5, by = 1)), labels=c("Married", "Widowed", "Divorced", "Separated", "Never Married")) + theme_classic() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + scale_y_continuous(breaks = (seq(1,3, by = 1))) + labs(

    title = "How Marital Status Impacts Happiness",

    x = "Marital Status",

    y = "Happiness",

    caption = "Data from the General Social Survey")

```

The above graph shows that for all marital statuses, the majority of respondents ranked their happiness at a 2. This aligns with the histogram above, which shows that the majority of respondents in the General Social Survey ranked their happiness at a 2, as well. An interesting finding, however, is that the plot above reveals that for all marital statuses, except for "married", the second most selected happiness rating was a 3, meaning very happy. For those in the "married" category, the second highest ranked happiness rating was 1, being very unhappy. This reveals that there may be a slight negative correlation between being married and being happy. All in all, there are no strong correlations above, which is good news for public policy makers, who don't need to focus on marital status when trying to improve the well being of their constituents.

## Data Visualization #4: Examining how education level interacts with reported happiness levels

```{r}

#Alicia inserts code here

```

======= The following dataset is pulled from the NORC General Social Survey for the years 2021 and 2022. Variables related to race, ethnicity, employment status, family income, immigration status, political party affiliation, perceptions of foreign spending, overall happiness, application of skills within the workplace, and ancestral continent of origin were selected.
